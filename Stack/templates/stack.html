{% block additional_headers %}
  <script type="text/javascript" src="{{ STATIC_URL }}tinymce/tinymce.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}tinymce/jquery.tinymce.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/stack.js"></script>
  <link rel="stylesheet" href="{{ STATIC_URL }}css/challenge.css" type="text/css" media="screen"/>
  <link rel="stylesheet" href="{{ STATIC_URL }}css/stack.css" type="text/css" media="screen"/>
{% endblock %}

<div class="challenges_stack">
	<div class="stack_info">
		<div class="info_title">
  		  {{ stack.title }}
	  	</div>
		<div class="info_description">
  		  {{stack.description}}
		</div>
	</div>
	<div class="challenge_list">
		{% for challenge_dict in challenges_active %}
			<div class="one_challenge active" challenge_id="{{ challenge_dict.challenge.id }}">
				<div class="challenge_image_container" challenge_id="{{ challenge_dict.challenge.id }}">
		    		<img class="challenge_image active" src="{{ STATIC_URL }}img/{{ challenge_dict.challenge.image_url }}">
				</div>
		  	  <div class="challenge-description">
  		        <div class="challenge-headline">{{ challenge_dict.challenge.title }}</div>
		  		{% if challenge_dict.challenge.description|wordcount > 50 %}
		  		 	{{ challenge_dict.challenge.description | truncatewords:50}} 
		  		{% else %}
		  			{{challenge_dict.challenge.description}}
		  		{% endif %}
			  	<div class="go_challenge button XL">
				  ENTER
			  	</div>
		  	  </div> 
<!-- writing reviews -->
			  {% if not user.is_staff %}
				  {% if not challenge_dict.challenge.is_final_challenge %}
				  <div class="challenge_footer">
				  	{% if not stack_blocked %}
						<div class="review_space">
				  		{% for review in challenge_dict.reviews %}
				  			{% if review %}
				  				{% if review.submitted %}
				  				<div class="review_box done" challenge_id="{{ challenge_dict.challenge.id }}">
				  					<i class="fa fa-check-square-o fa-lg"></i>
				  				</div>
				  				{% else %}
				  				<div class="review_box in_progress" challenge_id="{{ challenge_dict.challenge.id }}">
				  					<i class="fa fa-pencil-square-o fa-lg"></i>
				  				</div>
				  				{% endif %}
				  			{% elif not challenge_dict.submitted %}
				  				<div class="review_box inactive"></div>
				  			{% else %}
				  				<div class="review_box active" challenge_id="{{ challenge_dict.challenge.id }}">
				  				<i class="fa fa-pencil-square-o fa-lg"></i>
				  			</div>
				  			{% endif %}
				  		{% endfor %}
						</div>
				  	{% endif %}
				  {% endif %}
<!-- status -->
				  <div class="status_space">
				  <b>Status:</b>
				  <span>{{ challenge_dict.status.status }}</span>
				  <br>
				  <b>Next:</b>
				  <span>{{ challenge_dict.status.next }}</span>
				  {% if challenge_dict.points %}
				  <br>
				  <b>Points:</b>
				  <span>{{ challenge_dict.points }}</span>
				  {% endif %}
<!-- review results -->
				  <div class="peer_reviews" challenge_id="{{ challenge_dict.challenge.id }}">
					  {% if challenge_dict.awesome or challenge_dict.success or challenge_dict.fail or challenge_dict.nothing %}
					  	  <b>Your work has been reviewed: </b>
					  {% endif %}

					  {% if challenge_dict.awesome %}
					  <span class="received_review">
						  {{ challenge_dict.awesome }} x <span class="review_token">Great work</span> &nbsp;
					  </span>
					  {% endif %}
					  {% if challenge_dict.success %}
					  <span class="received_review">
						  {{ challenge_dict.success }} x <span class="review_token">Good Work</span> &nbsp;
					  </span>
					  {% endif %}
					  {% if challenge_dict.fail %}
					  <span class="received_review">
						  {{ challenge_dict.fail }} x <span class="review_token">Barely Acceptable</span> &nbsp;
					  </span>
					  {% endif %}
					  {% if challenge_dict.nothing %}
					  <span class="received_review">
						  {{ challenge_dict.nothing }} x <span class="review_token red">Unacceptable</span> &nbsp;
					  </span>
					  {% endif %}
					  {% if challenge_dict.awesome or challenge_dict.success or challenge_dict.fail or challenge_dict.nothing %}
					  <span class="button received_review"><span>see reviews</span></span>
					  {% endif %}
					  
				  </div>
			  </div>
		  </div>

			  {% endif %}  
			</div>
			
		{% endfor %}
		<div class="one_challenge">
			&nbsp;
		</div>
	</div>
	{% if challenges_inactive %}
	<div class="divider">&nbsp;
	  <i class="fa fa-scissors" style="position:relative;top:-9px;left:200px;"></i>
	</div>
	{% endif %}
	
	{% if not user.is_staff %}
	<div class="challenge_list inactive">
		{% for challenge in challenges_inactive %}
			<div class="one_challenge">
				<div class="challenge_image_container">
		    		<img class="challenge_image active" src="{{ STATIC_URL }}img/{{ challenge.image_url }}">
				</div>
		  	  <div class="challenge-description">
  		        <div class="challenge-headline">{{ challenge.title }}</div>
	      		{% if challenge.description|wordcount > 50 %}
      		 		{{ challenge.description | truncatewords:50}}
		  		{% else %}
					{{challenge.description}}
		  		{% endif %}
		  	  </div>
			</div>
		{% endfor %}
		
		<div class="one_challenge">
			&nbsp;
		</div>
	</div>
	{% endif %}
	
</div>







<table class="challenges_stack">
  <tr>
	  <td colspan="2" class="row1">
		  {{ stack.title }}
	  </td>
  </tr>
  <tr>
	  <td colspan=2>
		  {{stack.description}}<br><br>
	  </td>
  </tr>
{% if user.is_staff %}
{% for challenge_dict in challenges_active %}
  <tr>
    <td class="lineD">
      <img class="challenge_image active" src="{{ STATIC_URL }}img/{{ challenge_dict.challenge.image_url }}">
    </td>
    <td class="challenge active lineL" challenge_id="{{ challenge_dict.challenge.id }}">
      <div class="challenge-headline">{{ challenge_dict.challenge.title }}</div>
	  <div class="challenge-description">
		{% if challenge_dict.challenge.description|wordcount > 50 %}
		 	{{ challenge_dict.challenge.description | truncatewords:50}} 
			<div class="challenge-fulldescription">
				{{challenge_dict.challenge.description}}
			</div>
		{% else %}
			{{challenge_dict.challenge.description}}
		{% endif %}
	  </div>
    </td>
  </tr>
{% endfor %}
{% for challenge in challenges_inactive %}
  <tr>
    <td class="lineL"><img class="challenge_image active" src="{{ STATIC_URL }}img/{{ challenge.image_url }}"></td>
    <td class="challenge active lineL" challenge_id="{{ challenge.id }}">
        <div class="challenge-headline">{{ challenge.title }}</div>
  	  <div class="challenge-description">
    		{% if challenge.description|wordcount > 50 %}
    		 	{{ challenge.description | truncatewords:50}}
				<div class="challenge-fulldescription">
					{{challenge.description}}
				</div>
    		{% else %}
    			{{challenge.description}}
    		{% endif %}
	  </div>
  </tr>
{% endfor %}
{% else %}
{% for challenge_dict in challenges_active %}
  <tr>
    <td class="lineL">
      <img class="challenge_image active" src="{{ STATIC_URL }}img/{{ challenge_dict.challenge.image_url }}">
    </td>
    <td class="challenge active lineL" challenge_id="{{ challenge_dict.challenge.id }}">
        <div class="challenge-headline">{{ challenge_dict.challenge.title }}</div>
  	  <div class="challenge-description">
  		{% if challenge_dict.challenge.description|wordcount > 50 %}
  		 	{{ challenge_dict.challenge.description | truncatewords:50}}
			<div class="challenge-fulldescription">
				{{challenge_dict.challenge.description}}
			</div>
  		{% else %}
  			{{challenge_dict.challenge.description}}
  		{% endif %}
  	  	
  	  </div>
    </td>
  </tr>
  <tr>
    <td class="review_wrapper lineD">
{% if not challenge_dict.challenge.is_final_challenge %}
	{% if not stack_blocked %}
		{% for review in challenge_dict.reviews %}
			{% if review %}
				{% if review.submitted %}
				<div class="review_box done" challenge_id="{{ challenge_dict.challenge.id }}">
					<i class="fa fa-check-square-o fa-lg"></i>
				</div>
				{% else %}
				<div class="review_box in_progress" challenge_id="{{ challenge_dict.challenge.id }}">
					<i class="fa fa-pencil-square-o fa-lg"></i>
				</div>
				{% endif %}
			{% elif not challenge_dict.submitted %}
				<div class="review_box inactive"></div>
			{% else %}
				<div class="review_box active" challenge_id="{{ challenge_dict.challenge.id }}">
				<i class="fa fa-pencil-square-o fa-lg"></i>
			</div>
			{% endif %}
		{% endfor %}
	{% endif %}
{% endif %}
    </td>

    <td class="challenge lineD">
        <b>Status:</b>
        <span>{{ challenge_dict.status.status }}</span>
        <br>
        <b>Next:</b>
        <span>{{ challenge_dict.status.next }}</span>
  {% if challenge_dict.points %}
        <br>
        <b>Points:</b>
        <span>{{ challenge_dict.points }}</span>
  {% endif %}
        <div class="peer_reviews" challenge_id="{{ challenge_dict.challenge.id }}">
  {% if challenge_dict.awesome %}
          <span class="received_review">
            {{ challenge_dict.awesome }} x <span class="review_token">Great work</span> &nbsp;
          </span>
  {% endif %}
  {% if challenge_dict.success %}
          <span class="received_review">
            {{ challenge_dict.success }} x <span class="review_token">Good Work</span> &nbsp;
          </span>
  {% endif %}
  {% if challenge_dict.fail %}
          <span class="received_review">
            {{ challenge_dict.fail }} x <span class="review_token">Barely Acceptable</span> &nbsp;
          </span>
  {% endif %}
  {% if challenge_dict.nothing %}
          <span class="received_review">
            {{ challenge_dict.nothing }} x <span class="review_token red">Unacceptable</span> &nbsp;
          </span>
  {% endif %}
        </div>
    </td>
  </tr>
  <tr><td>&nbsp;</td></tr>
{% endfor %}
</table>

{% if challenges_inactive %}
<div class="divider">&nbsp;
  <i class="fa fa-scissors" style="position:relative;top:-9px;left:200px;"></i>
</div>
{% endif %}
<table class="challenges_stack">
{% for challenge in challenges_inactive %}
  <tr>
    <td class="lineL below"><img class="challenge_image" src="{{ STATIC_URL }}img/{{ challenge.image_url }}"></td>
    <td class="challenge below" challenge_id="{{ challenge.id }}">
        <div class="challenge-headline">{{ challenge.title }}</div>
    	  <div class="challenge-description">
      		{% if challenge.description|wordcount > 50 %}
      		 	{{ challenge.description | truncatewords:50}}
				<div class="challenge-fulldescription">
					{{challenge.description}}
				</div>
      		{% else %}
      			{{challenge.description}}
      		{% endif %}
  	  </div>
    </td>
  </tr>
{% endfor %}
{% endif %}
</table>