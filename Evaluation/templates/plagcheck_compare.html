{% load filter %}
{% load staticfiles %}

{% block additional_headers %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/info_area.js"></script>
    <script type="text/javascript" src="{% static "js/jsdiff/diff.js" %}"></script>
    <link rel="stylesheet" href="{% static "css/plagcheck.css" %}" type="text/css" media="screen"/>
{% endblock %}

{% block content %}
        <div>
            {% if prev_suspect_id %}
                <a href="{% url 'Evaluation:plagcheck_compare' course_short_title=course.short_title suspect_id=prev_suspect_id %}?{{ request.GET.urlencode }}">Prev</a>
            {% endif %}
            {% if next_suspect_id %}
                <a href="{% url 'Evaluation:plagcheck_compare' course_short_title=course.short_title suspect_id=next_suspect_id %}?{{ request.GET.urlencode }}">Next</a>
            {% endif %}
        </div>
        <div>
            <form name="suspect_state" method="post"
                  action="{% url 'Evaluation:plagcheck_compare_save_state' course_short_title=course.short_title suspect_id=suspect.id %}">
                <label>Suspect state:</label>
                <select name="suspect_state_selection" onchange="suspect_state.submit()">
                    {% for state in suspect_states %}
                        <option {% if suspect.state_enum.value == state.value %} selected {% endif %}
                                value="{{ state.value }}">{{ state.name }}</option>
                    {% endfor %}
                </select>
            </form>
        </div>
        <div>
        Result:<br />
        # hashes: {{ suspect.result.hash_count }}<br />
        # matching hashes: {{ suspect.match_count }}<br />
        Similarity: {{ suspect.similarity }}%<br />
        Date: {{ suspect.result.created }}<br />
        </div>


        <table>
            <tr>
                <th>PersonA</th>
                <th>PersonB</th>
            </tr>
            <tr>
                <td>
                    Name: {{ suspect.stored_doc.user.nickname }}<br />
                    User ID: {{ suspect.stored_doc.user_id }}<br />
                    Doc ID: {{ suspect.stored_doc_id }}
                </td>
                <td>
                    Name: {{ suspect.similar_to.user.nickname }}<br />
                    User ID: {{ suspect.similar_to.user_id }}<br />
                    Doc ID: {{ suspect.similar_to_id }}
                </td>
            </tr>
        </table>

        <div id="sides">
            <div id="left">
                {% autoescape off %}
                    {{ suspect.stored_doc.text | safe }}
                {% endautoescape %}
            </div>
            <div id="right">
            </div>

            <script>
            {% autoescape off %}
                var one = {{ suspect.stored_doc.json_text }};
                var other = {{ suspect.similar_to.json_text }};

                var diff = JsDiff.diffWordsWithSpace(one.content, other.content);
                var display = document.getElementById('right');
            {% endautoescape %}

            var text_node = null
            diff.forEach(function(part){
                if (part.removed || part.added) {
                    display.innerHTML += part.value;
                } else {
                    display.innerHTML += "<mark>"+part.value+"</mark>";
                }
                /**
                if (part.removed || part.added) {
                    if (text_node == null) {
                        text_node += " " + part.value
                    } else {
                        text_node = document.createTextNode(part.value)
                        display.appendChild(text_node);
                    }
                } else {
                    text_node = null;
                    var span = document.createElement('mark');
                    var color = 'green';
                    span.appendChild(document.createTextNode(part.value));
                    display.appendChild(span);
                }**/
            });
            </script>

        </div>


{% endblock %}