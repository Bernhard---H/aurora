{% load comments %}
{% block additional_headers %}
  <script type="text/javascript" src="{{ STATIC_URL }}tinymce/tinymce.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}tinymce/jquery.tinymce.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/detail.js"></script>
  <link rel="stylesheet" href="{{ STATIC_URL }}css/evaluation.css" type="text/css" media="screen"/>
  <script type="text/javascript" src="{{ STATIC_URL }}js/file_upload.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}lightbox/js/lightbox-2.6.min.js"></script>
  <link rel="stylesheet" href="{{ STATIC_URL }}lightbox/css/lightbox.css" type="text/css" media="screen"/>
{% endblock %}


{% block content %}

  <h1>Detailview</h1>
  <div class="pagination">
     {% if prev %}<div class="paginator prev" id="{{ prev }}"><i class="fa fa-angle-double-left"></i> prev</div>{% endif %}
     {% if next %}<div class="paginator next" id="{{ next }}">next <i class="fa fa-angle-double-right"></i></div>{% endif %}
 </div>
 <br>
  <div class="detail_left">

        <img class="gravatar" src="../{{ elaboration.user.avatar.url }}" style="vertical-align:middle">
        {{ elaboration.user.nickname }} ({{ elaboration.user.first_name }} {{ elaboration.user.last_name }}, {{ elaboration.user.username }})
        <div class="spacer"></div>

        <div class="file_upload" style="display: none">
          <form action="/fileupload" class="dropzone dz-clickable is_submitted" id="dropzone">
            <input id="elaboration_id" type="hidden" name="elaboration_id" value="{{ elaboration.id }}"/>
            {% csrf_token %}
          </form>
        </div>

        <textarea id="editor">{{ elaboration.elaboration_text }}</textarea>
        <div class="spacer"></div>

        {% if evaluation %}
		Written feedback
            <form method="post">
                {% csrf_token %}
                {% if evaluation.submission_time %}
				    <div class="evaluation">
                        {{ evaluation.evaluation_text }}
                    </div>
                    points assigned<div class="points">{{ evaluation.evaluation_points }}</div>
                    <div class="submission_date">
                        evaluated on {{ evaluation.submission_time }}
                        <button class="reopen_evaluation" id="{{ elaboration.id }}">Reopen</button>
                    </div>
                {% else %}
                    <div class="evaluation" {% if not lock %} contenteditable="true" {% endif %}
                            onkeyup="DelayedAutoSave({{ elaboration.id }})">
                        {{ evaluation.evaluation_text }}{% if lock %}<div class="evaluation_lock">locked by {{ evaluation.tutor.username }}</div>{% endif %}
                    </div>
                    Points <div class="points" {% if not lock %} contenteditable="true" {% endif %} onkeyup="DelayedAutoSave({{ elaboration.id }})">
                        {% if evaluation.evaluation_points %}{{ evaluation.evaluation_points }}{% endif %}</div>
                    {% if not lock %}<button class="submit_evaluation XL" id="{{ elaboration.id }}">evaluate</button>{% endif %}
                {% endif %}
            </form>
            <div class="spacer"></div>
        {% endif %}

        {% if elaboration %}
		<div class="comments">
			<b>Comment section: discussion with autor</b>
            {% render_comment_list for elaboration %}
		</div>
        {% endif %}

        {% if reviews %}
            <div class="spacer"></div>
            {% include "reviews.html" %}
        {% endif %}
        {% if selection == 'missing_reviews' %}
            <div class="spacer"></div>
            {% include "add_review.html" %}
        {% endif %}
  </div>

  <div class="detail_right">
    <div class="menu">
        <div class="stack">stack</div>
        <div class="others">others</div>
        <div class="challenge_txt">challenge text</div>
    </div>
    <div class="spacer"></div>
    <div id="info_area">{% include "user_stack.html" %}</div>
  </div>

  <div class="clear"></div>

{% endblock %}