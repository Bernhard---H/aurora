{% load comments %}

{% block additional_headers %}
  <script type="text/javascript" src="{{ STATIC_URL }}tinymce/tinymce.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}tinymce/jquery.tinymce.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/challenge.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/file_upload.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}lightbox/js/lightbox-2.6.min.js"></script>
  <link rel="stylesheet" href="{{ STATIC_URL }}css/challenge.css" type="text/css" media="screen"/>
  <link rel="stylesheet" href="{{ STATIC_URL }}lightbox/css/lightbox.css" type="text/css" media="screen"/>

{% endblock %}

<div id="{{ challenge.id }}" class="challenge" stack="{{ challenge.get_stack.id }}">

   <div class="challenge_title" {% if elaboration.is_submitted %}onclick="$('.challenge_description').toggle('fast');" {% endif %}>
	   {% if elaboration.is_submitted %}<i class="fa fa-toggle-down"></i>{% endif %}
    {{ challenge.title }}
  </div>

  <div class="challenge_description{% if elaboration.is_submitted %} nothere{% endif %}" >
    {{ challenge.description }}

  <div class="qa_section">
    <div class="comments">
      <span><b {% if not elaboration.is_submitted %}onclick="$('#qa').toggle('fast');"><i class="fa fa-toggle-down"></i{% endif %}> 
		  Challenge Q+A Section</b> - {% comments_count for challenge %} comments so far
	  </span>

      <div id="qa" class="challenge_comments">If you have questions about the description of this challenge, post
	  them here. The course organizers will answer as soon as possible.
        {% render_comment_list for challenge %}
      </div>
    </div>
  </div>
</div>

  {% if user.is_staff %}
	  [you are admin. you cannot accept challenges]
  <!-- admin corner -->
  <!-- xxxxxxxxxxxx -->  
  {% else %}

  {% if not elaboration.is_submitted %}

    {% if not accepted %}
      <div id="Caccept" class="button XL"
           onclick="$('.elaboration_block').toggle('fast');$('#Caccept').toggle('fast');$('#qa').toggle('fast');">
        accept challenge
      </div>
    {% endif %}

    <div class="elaboration_block{% if not elaboration.elaboration_text %} unstarted{% endif %}">
      {% if challenge.accepted_files %}
        <div class="file_upload" accepted_files="{{ challenge.accepted_files }}">
          <form action="/fileupload"
                class="dropzone dz-clickable{% if elaboration.is_submitted %} is_submitted{% endif %}"
                id="dropzone">
            <input id="elaboration_id" type="hidden" name="elaboration_id" value="{{ elaboration.id }}"/>
            {% csrf_token %}
          </form>
	  	  <div style="font-size:80%">Note: use »Fig.X« in your text to reference to uploaded images.</div>
        </div>
      {% endif %}

      <form method="post">
        <textarea id="editor">{{ elaboration.elaboration_text }}</textarea>
      </form>
      <button class="submit XL R">Enter work for Evaluation</button>
      <div class="submission_text" hidden>
        <div>
          I certify that the work presented here is, to the best of my knowledge and belief, original and the result of
          my
          own investigations and creation, except as acknowledged, and has not been submitted, either in part or whole,
          for
          a degree at this or any other University.
        </div>
        <div>
          <button class="real_submit XL R" id="{{ challenge.id }}">Submit work</button>
        </div>
      </div>
    </div>
  {% else %}
    {% if challenge.accepted_files %}
      <div class="file_upload" accepted_files="{{ challenge.accepted_files }}">
        <form action="/fileupload"
              class="dropzone dz-clickable{% if elaboration.is_submitted %} is_submitted{% endif %}"
              id="dropzone">
          <input id="elaboration_id" type="hidden" name="elaboration_id" value="{{ elaboration.id }}"/>
          {% csrf_token %}
        </form>
      </div>
    {% endif %}
{#    <div class="elaboration_text">{{ elaboration.elaboration_text |safe }}</div> <!-- TODO: this has to be secure -->#}
    <textarea id="editor_challenge">{{ elaboration.elaboration_text|safe }}</textarea>
    {% if evaluation %}
    <div class="comments">
      <div class="evaluation_text">Evaluation text: {{ evaluation.evaluation_text }}</div>
    </div>
    {% endif %}
    <div class="comment_section">
      <div class="comments">
        <div class="elaboration_comments">
          <b>Discuss with LVA team</b> - {% comments_count for elaboration %} comments so far
          {% render_additional_comment_list for elaboration %}
        </div>
      </div>
    </div>
    {% endif %}
{% endif %}
  
</div>